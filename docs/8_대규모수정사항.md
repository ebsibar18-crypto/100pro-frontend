# 8. 대규모수정사항

## 변경 배경
- 기존 `진행 전 / 진행 중 / 진행 완료` 3단계 상태는 사용자 입장에서 복잡도가 높음
- 사용자가 제안한 흐름(체크 기반 완료/미완료)이 더 직관적이므로 상태 모델을 단순화
- 등록 시점에는 상태 선택보다 메모 입력이 실제 사용성에 더 중요함

## 변경 목표
- 체크박스 기반 2상태 체계로 전환 (`미완료/완료`)
- 등록 화면에서 `시작 상태` 제거, `상세 메모` 필드 추가
- Home 카드에 `상세보기` 버튼 추가
- 상세보기 클릭 시 상세 화면으로 이동, 뒤로가기로 Home 복귀

## 적용 범위
- Todo 데이터 모델/저장소
- Home 화면 카드 액션
- 등록(Compose) 화면 폼
- Todo 상세 화면 신규 라우팅
- 보관함/일정 화면의 상태 집계 로직

## 데이터 모델 변경
### 이전
- `status: 'ready' | 'doing' | 'done'`

### 이후
- `isDone: boolean`
- `memo: string`
- `createdAt: string`
- `archived: boolean`

### 마이그레이션
- localStorage persist 데이터의 구버전(`status`)을 신규(`isDone`)로 자동 변환
- `status === 'done'`이면 `isDone=true`, 그 외는 `false`

## 화면/플로우 변경 사항
### Home
- 상태 섹션 분리 제거
- 단일 리스트에서 체크박스로 완료/미완료 토글
- 카드 액션: `상세보기 / 보관 / 삭제`

### 등록
- `시작 상태` 필드 제거
- `상세 메모` textarea 추가
- 저장 시 기본값은 미완료(`isDone=false`)

### 상세 화면 (`/todo/:id`)
- 표시: 제목, 날짜, 메모, 이모티콘/스티커 placeholder
- 상단: 뒤로가기 + 더보기 버튼
- 뒤로가기 클릭 시 `/home` 이동

### 보관함/일정
- `isDone` 기준으로 미완료/완료 집계 및 UI 표시

## 구현 파일
- `5todolist/src/5todolist/todoStore.ts`
- `5todolist/src/5todolist/HomePage.tsx`
- `5todolist/src/5todolist/ComposePage.tsx`
- `5todolist/src/5todolist/TodoDetailPage.tsx` (신규)
- `5todolist/src/5todolist/SchedulePage.tsx`
- `5todolist/src/box/ArchivePage.tsx`
- `5todolist/src/app/router.tsx`
- `5todolist/src/index.css`

## 시행 결과
- [v] 상태 체계 단순화 완료
- [v] 상세 메모 입력 흐름 반영 완료
- [v] 상세보기 -> 상세화면 -> Home 복귀 동선 반영 완료
- [v] 보관함/일정 화면 로직 동기화 완료
- [v] 기존 persist 데이터 마이그레이션 반영 완료

## 수정 요청 및 반영 내역
- [v] 보관함 탭 클릭 시 로그인으로 이동되던 흐름을 테스트용으로 임시 개방 반영
- [v] 보관함 화면을 시안에 맞춰 카드형 UI/완료 영역 분리/더보기 메뉴(`...`) 반영
- [v] 보관함 진입 시 `Maximum update depth exceeded` 오류 수정(zustand selector 안정화)
- [v] Home에서 `오늘 할 일 +` 클릭 시 즉시 생성 대신 `등록` 탭 이동 흐름으로 변경
- [v] MY(로그인) 화면을 시안 비율에 맞춰 대폭 리디자인(상단 다크 영역/카드 패널/입력영역)
- [v] Google SSO 제거 및 `Or login with` 하단 이메일 로그인 방식 유지 반영
- [v] 하단바를 `lucide-react` 아이콘 기반으로 교체(중앙 원형 CTA 포함)
- [v] 첫 랜딩(스플래시) 화면을 시안 톤으로 재구성하고 스플래시에서 하단바 숨김 처리
- [v] 온글잎 박다현 폰트를 스플래시 로고에 적용
- [v] Home의 `5늘할일` 타이틀에만 온글잎 박다현 폰트 적용
- [v] `온글잎 김콩해` 웹폰트(CDN) 추가 및 기본 폰트 계층 반영(환경별 폰트 표시 일관화)
- [v] Home/등록/로그인(MY) 화면에서 미적용되던 텍스트, 입력값, placeholder, 버튼 폰트까지 `온글잎 김콩해` 적용 범위 확장
- [v] 전체 가독성 개선을 위한 폰트 크기 상향 및 줄바꿈 방지(`nowrap`/`ellipsis`/`line-height`) 보정
- [v] 로그인 상단 타이틀 문구를 `사용하시려면` + `로그인 하세요` 2줄 고정으로 변경
- [v] `Or login with` 하단 이메일 로그인 영역 레이아웃 안정화(입력 필드/메타 행/로그인 버튼 정렬)
- [v] `로그인 상태 유지` 체크박스 커스텀 보정: 정사각형 고정, 체크 시 시각 표시, 텍스트와 한 줄 정렬
- [v] 로그인 하단 `아직 회원이 아니세요? 회원가입` 문구 추가 및 `회원가입` 버튼은 현재 동작 없는 상태로 반영

## 추가 반영 내역 (2026-02-23)
- [v] 상단 콘텐츠 시작 위치를 모바일 기준으로 하향 보정: `mobile-main`에 반응형 top offset(`clamp`) 적용
- [v] iOS 안전영역 대응 강화: `mobile-main` 하단 패딩에 `env(safe-area-inset-bottom)` 반영
- [v] Home/일정/할 일 등록 헤더 타이틀을 보관함과 동일한 42px로 통일 (`.home-header h1`)
- [v] 하단 네비 탭 전환 시 기준선 흔들림(특히 `MY`) 완화: 네비 아이템/라벨/아이콘 높이 고정 및 폰트 굵기 통일
- [v] `MY(로그인)` 화면의 과도한 스크롤/빈 하단 영역 보정: 로그인 전용 `main` 클래스 분기(`login-main`) 및 스크롤 제한
- [v] `login-screen` 레이아웃 여백 조정(`margin: -16px -16px 0`)으로 탭 전환 시 상하 흔들림 체감 완화
- [v] 콘텐츠 본문 가독성 확대 요구 반영: 전 화면 공통 타이포/카드/버튼/입력 크기 상향 후, 사용자 피드백에 따라 약 1.5배 체감으로 재조정
- [v] Home 카드 액션 UX 개편:
  - `상세보기` 버튼만 유지
  - `보관/삭제` 버튼 제거
  - 우->좌 스와이프 시 보관(Archive 아이콘 + `보관함` 애니메이션)
  - 좌->우 스와이프 시 삭제(X 아이콘 + `삭제` 애니메이션)
- [v] 삭제 안정성 UX 반영: `삭제 후 3초 Undo` 토스트(진행바 포함) 추가, 3초 내 `되돌리기`로 복구 가능
- [v] Undo 복구 정확도 확보: store에 `insertTodo(todo, index?)` 액션 추가하여 삭제 전 인덱스로 복원

## 추가 반영 내역 (2026-02-24)
- [v] 등록(Compose) 핫픽스: `등록하기` 클릭 시 반영되지 않던 이슈 수정
  - `crypto.randomUUID()` 미지원 환경 fallback ID 생성 로직(`createTodoId`) 추가
  - 등록 submit 예외 처리(`try/catch`) 추가로 무반응 대신 오류 문구 노출
- [v] 상세 화면(`/todo/:id`) UI/UX 개편
  - 외곽 프레임(큰 테두리 카드) 제거, 플랫 레이아웃으로 정리
  - 좌측 뒤로가기 아이콘을 텍스트 화살표에서 Lucide `ChevronLeft`로 교체
  - 우측 `...` 버튼 제거, Lucide `Pencil`(수정) 아이콘으로 교체
  - 미사용 요소 정리: 회색 이모티콘 박스/스티커 박스 제거
- [v] 상세 화면 편집 기능 구현
  - 연필 아이콘 클릭 시 제목/메모 편집 모드 진입
  - `저장/취소` 버튼 및 유효성 검사(제목 필수, 제목 40자/메모 500자 제한) 반영
  - store에 `updateTodo(id, { title?, memo? })` 액션 추가해 저장 반영
- [v] 상세 화면 정보 위계 개선
  - 날짜를 제목 바로 아래로 이동
  - Dayjs 한국어 locale 적용으로 요일 표기 통일(`월요일` 등)
  - 날짜와 상태 문구 간 여백 확대로 구분감 강화
  - 편집 중 뒤로가기 시 미저장 변경 경고(`저장하지 않고 나가시겠어요?`) 추가
- [v] 로그인 상단 이모지 리브랜딩
  - 기존 🙂 텍스트 이모지를 제공된 SVG 에셋으로 교체
  - `.login-emoji` 스타일을 SVG 렌더링 기준으로 재정렬(기존 원형 배경 제거)
- [v] Home 안내 문구 구조 개편
  - 상단 `오늘에만 집중해요...` 문구 제거
  - `오늘 할 일 작성하러 가기 +` CTA와 `*최대 5개까지만 등록할 수 있어요.` 안내를 분리
  - 안내 문구를 버튼 박스 밖 하단 우측 보조 텍스트로 배치
- [v] 하단 네비 Home 아이콘 의미 개선: 햄버거(`Menu`) -> 홈(`House`) 아이콘 교체
- [v] 보관함 더보기 메뉴 UX 개선: 메뉴 오픈 상태에서 외부 영역 클릭/터치 시 자동 닫힘 처리

## 추가 반영 내역 (2026-02-24, 캘린더/정책 확장)
- [v] 하단 탭/타이틀 한글화 정리
  - 하단 탭: `Home -> 투두`, `일정 -> 캘린더`, `MY -> 마이`
  - 일정 화면 헤더: `오늘 일정 -> 캘린더`
- [v] 일정 화면을 통계 카드형에서 월간 캘린더형으로 전환
  - 미래 날짜는 회색 비활성(조회/선택 제한)
  - 점(dot)은 활성 todo 기준으로 표시
  - 점 있는 날짜를 클릭한 경우에만 하단 날짜별 리스트 표시
  - 월 이동(이전 달/다음 달) 시 선택 상태 초기화, 리스트 자동 노출 방지
  - 사용자 기기 시간대 기반 자정 계산 안내 문구 노출
- [v] 캘린더 데이터 흐름 확장
  - `deletedTodos` 상태 추가 및 삭제 이력 분리 기록
  - 2/22, 2/23 시나리오형 목업 데이터 보강(진행/완료/보관/삭제)
  - persist 병합 로직(version/merge) 추가로 기존 로컬 데이터와 목업 데이터 공존 보장
- [v] Home 표시 정책 강화
  - Home(투두)는 `오늘 날짜 + 보관 제외` 항목만 노출되도록 필터 고정
  - 오늘 5개 제한도 전체가 아닌 `오늘 활성 항목` 기준으로 계산
- [v] 과거 날짜 정책 반영
  - 과거 날짜 할 일은 상세에서 수정 불가(읽기 전용 안내)
  - 캘린더 과거 날짜의 진행 중 항목은 체크로 완료 처리 가능
  - 과거 완료 항목에 미완료 되돌리기 옵션 제거
- [v] 캘린더 과거 진행중 행 UX 확장
  - 체크 즉시 완료 처리 + 1회 페이드 애니메이션
  - 스와이프 액션 도입: 좌->우 삭제, 우->좌 보관
- [v] 보관함 정책 재정의
  - 보관함은 미완료 보류 항목만 관리(완료 항목 보관 금지)
  - 보관함 체크박스 제거
  - 카드 영역 클릭 시 즉시 상세보기 진입
  - `...` 메뉴를 `오늘 할일`, `삭제` 2개로 단순화
  - `오늘 할일` 실행 시 오늘 날짜의 미완료 항목으로 재지정(createdAt 갱신)
- [v] 상세 페이지 뒤로가기 동선 개선
  - 상세 진입 출발 화면을 state로 전달
  - 뒤로가기 시 진입한 화면으로 복귀(Home/캘린더/보관함)
  - 캘린더에서 진입한 경우 선택 날짜/월 상태까지 복원
- [v] Home 정책 안내 보강
  - `*최대 5개...` 옆 `CircleHelp` 아이콘 추가
  - 클릭 시 반응형 모달 팝업(메시지/닫기 X/오버레이/ESC) 제공

## 후속 제안
- 상세 화면의 실제 이모티콘/스티커 선택 기능 구현
- 상세 화면의 수정/저장 기능 확장
- 백엔드 연동 시 메모 및 완료 상태 서버 동기화
